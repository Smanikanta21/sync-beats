This file consolidates key context and rationale previously embedded as code comments.

Scope:
- Frontend sync engine (useSyncPlayback)
- WebAudioScheduler
e- Socket server handshake and clocks
- PrecisionClock

1) Time Sync (Client)
- The client estimates server time via short "time_ping"/"time_pong" bursts to minimize jitter. A regression + EMA smoothing yields:
  - filtered offset: serverUnix - clientUnix
  - rtt/latency estimates used for scheduling and UI stats
- The server also returns a monotonic timestamp so the client can store (serverUnix - serverMonotonic) for Web Audio alignment.

2) WebAudioScheduler
- Schedules precise playback by converting the host’s master monotonic clock to a unix estimate, applying filtered offset and one‑way latency.
- If late, it advances the start position to maintain alignment and uses a small safety lead (~60ms).
- Drift correction strategy:
  - Small drift: temporary playbackRate skew with automatic reset to 1.0 when stable
  - Large drift: micro-reschedule by restarting the BufferSource at the corrected offset
- Exposes helpers to pause, resume, seek, set volume, get current position, and clear cached buffers.

3) Device Handshake (Server ↔ Clients)
- On PLAY, server triggers a PREPARE_TRACK request to preload on all clients
- Each client replies with device_health_check_response (audioLoaded/deviceReady + rtt)
- When quorum of devices are ready or timeout expires, the server broadcasts PLAY or PLAY_SYNC with a masterClockMs to start together
- RESUME, PAUSE, SEEK propagate to all devices; clients align positions accordingly

4) Mobile Autoplay Unlock (Client)
- iOS Safari requires a user gesture to unlock audio; the client registers touch/click handlers to initialize and resume the AudioContext before scheduling.

5) Identifiers & Connection Gating
- WebSocket connect is deferred until roomCode, userId, and hostId are known to avoid wasted connections and race conditions.

6) Room Page Behavior
- Host-only play/pause/seek; non-host devices receive state and schedule via the shared clock
- Track changes broadcast to synchronize queue transitions across devices

Notes
- This file is the single place retaining previously in-code explanations; the codebase is now comment-light per request.
- Update this file if behavior or protocol changes to keep the rationale discoverable without cluttering source files.
